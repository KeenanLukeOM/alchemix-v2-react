import{aw as ke,ax as We,ay as ve,az as $e,aA as C,aB as P,aC as He,aD as j,aE as Re,aF as B,aG as be,ai as Te,aH as Xe,u as Ae,Y as ze,Z as Ve,$ as qe,a3 as ne,a6 as Ke,a2 as fe,l as Je,aI as Qe,aJ as Ze,X as de,aK as Ye,aL as et,Q as Ie,aM as L,a0 as ye,j as s,aN as tt,z as y,_ as rt,aO as nt,S as z,N as V,O as q,R as K,U as J,V as Q,as as Z,aP as st,an as it,aQ as ot,B as at}from"./index-KZdNEMf0.js";import{u as ct}from"./useWalletClient-BeLJVzkw.js";import{_ as lt}from"./bn-CdVjIYbr.js";import"./___vite-browser-external_commonjs-proxy-DvsE6m7R.js";function ft(t){const e=[];{const r=ke(t),n=r.length;for(let o=0;o<n;o++)e.push(We(r[o],{modifiers:ve}))}if(e.length===0)throw new $e({params:t});return e}const dt="logger/5.7.0";let ue=!1,he=!1;const $={debug:1,default:2,info:2,warning:3,error:4,off:5};let ge=$.default,Y=null;function ut(){try{const t=[];if(["NFD","NFC","NFKD","NFKC"].forEach(e=>{try{if("test".normalize(e)!=="test")throw new Error("bad normalize")}catch{t.push(e)}}),t.length)throw new Error("missing "+t.join(", "));if("é".normalize("NFD")!=="é")throw new Error("broken implementation")}catch(t){return t.message}return null}const Ee=ut();var se;(function(t){t.DEBUG="DEBUG",t.INFO="INFO",t.WARNING="WARNING",t.ERROR="ERROR",t.OFF="OFF"})(se||(se={}));var A;(function(t){t.UNKNOWN_ERROR="UNKNOWN_ERROR",t.NOT_IMPLEMENTED="NOT_IMPLEMENTED",t.UNSUPPORTED_OPERATION="UNSUPPORTED_OPERATION",t.NETWORK_ERROR="NETWORK_ERROR",t.SERVER_ERROR="SERVER_ERROR",t.TIMEOUT="TIMEOUT",t.BUFFER_OVERRUN="BUFFER_OVERRUN",t.NUMERIC_FAULT="NUMERIC_FAULT",t.MISSING_NEW="MISSING_NEW",t.INVALID_ARGUMENT="INVALID_ARGUMENT",t.MISSING_ARGUMENT="MISSING_ARGUMENT",t.UNEXPECTED_ARGUMENT="UNEXPECTED_ARGUMENT",t.CALL_EXCEPTION="CALL_EXCEPTION",t.INSUFFICIENT_FUNDS="INSUFFICIENT_FUNDS",t.NONCE_EXPIRED="NONCE_EXPIRED",t.REPLACEMENT_UNDERPRICED="REPLACEMENT_UNDERPRICED",t.UNPREDICTABLE_GAS_LIMIT="UNPREDICTABLE_GAS_LIMIT",t.TRANSACTION_REPLACED="TRANSACTION_REPLACED",t.ACTION_REJECTED="ACTION_REJECTED"})(A||(A={}));const me="0123456789abcdef";class c{constructor(e){Object.defineProperty(this,"version",{enumerable:!0,value:e,writable:!1})}_log(e,r){const n=e.toLowerCase();$[n]==null&&this.throwArgumentError("invalid log level name","logLevel",e),!(ge>$[n])&&console.log.apply(console,r)}debug(...e){this._log(c.levels.DEBUG,e)}info(...e){this._log(c.levels.INFO,e)}warn(...e){this._log(c.levels.WARNING,e)}makeError(e,r,n){if(he)return this.makeError("censored error",r,{});r||(r=c.errors.UNKNOWN_ERROR),n||(n={});const o=[];Object.keys(n).forEach(l=>{const N=n[l];try{if(N instanceof Uint8Array){let p="";for(let w=0;w<N.length;w++)p+=me[N[w]>>4],p+=me[N[w]&15];o.push(l+"=Uint8Array(0x"+p+")")}else o.push(l+"="+JSON.stringify(N))}catch{o.push(l+"="+JSON.stringify(n[l].toString()))}}),o.push(`code=${r}`),o.push(`version=${this.version}`);const d=e;let h="";switch(r){case A.NUMERIC_FAULT:{h="NUMERIC_FAULT";const l=e;switch(l){case"overflow":case"underflow":case"division-by-zero":h+="-"+l;break;case"negative-power":case"negative-width":h+="-unsupported";break;case"unbound-bitwise-result":h+="-unbound-result";break}break}case A.CALL_EXCEPTION:case A.INSUFFICIENT_FUNDS:case A.MISSING_NEW:case A.NONCE_EXPIRED:case A.REPLACEMENT_UNDERPRICED:case A.TRANSACTION_REPLACED:case A.UNPREDICTABLE_GAS_LIMIT:h=r;break}h&&(e+=" [ See: https://links.ethers.org/v5-errors-"+h+" ]"),o.length&&(e+=" ("+o.join(", ")+")");const g=new Error(e);return g.reason=d,g.code=r,Object.keys(n).forEach(function(l){g[l]=n[l]}),g}throwError(e,r,n){throw this.makeError(e,r,n)}throwArgumentError(e,r,n){return this.throwError(e,c.errors.INVALID_ARGUMENT,{argument:r,value:n})}assert(e,r,n,o){e||this.throwError(r,n,o)}assertArgument(e,r,n,o){e||this.throwArgumentError(r,n,o)}checkNormalize(e){Ee&&this.throwError("platform missing String.prototype.normalize",c.errors.UNSUPPORTED_OPERATION,{operation:"String.prototype.normalize",form:Ee})}checkSafeUint53(e,r){typeof e=="number"&&(r==null&&(r="value not safe"),(e<0||e>=9007199254740991)&&this.throwError(r,c.errors.NUMERIC_FAULT,{operation:"checkSafeInteger",fault:"out-of-safe-range",value:e}),e%1&&this.throwError(r,c.errors.NUMERIC_FAULT,{operation:"checkSafeInteger",fault:"non-integer",value:e}))}checkArgumentCount(e,r,n){n?n=": "+n:n="",e<r&&this.throwError("missing argument"+n,c.errors.MISSING_ARGUMENT,{count:e,expectedCount:r}),e>r&&this.throwError("too many arguments"+n,c.errors.UNEXPECTED_ARGUMENT,{count:e,expectedCount:r})}checkNew(e,r){(e===Object||e==null)&&this.throwError("missing new",c.errors.MISSING_NEW,{name:r.name})}checkAbstract(e,r){e===r?this.throwError("cannot instantiate abstract class "+JSON.stringify(r.name)+" directly; use a sub-class",c.errors.UNSUPPORTED_OPERATION,{name:e.name,operation:"new"}):(e===Object||e==null)&&this.throwError("missing new",c.errors.MISSING_NEW,{name:r.name})}static globalLogger(){return Y||(Y=new c(dt)),Y}static setCensorship(e,r){if(!e&&r&&this.globalLogger().throwError("cannot permanently disable censorship",c.errors.UNSUPPORTED_OPERATION,{operation:"setCensorship"}),ue){if(!e)return;this.globalLogger().throwError("error censorship permanent",c.errors.UNSUPPORTED_OPERATION,{operation:"setCensorship"})}he=!!e,ue=!!r}static setLogLevel(e){const r=$[e.toLowerCase()];if(r==null){c.globalLogger().warn("invalid log level - "+e);return}ge=r}static from(e){return new c(e)}}c.errors=A;c.levels=se;const ht="bytes/5.7.0",ee=new c(ht);function gt(t){return!!t.toHexString}function Ne(t){return typeof t=="number"&&t==t&&t%1===0}function Ce(t){if(t==null)return!1;if(t.constructor===Uint8Array)return!0;if(typeof t=="string"||!Ne(t.length)||t.length<0)return!1;for(let e=0;e<t.length;e++){const r=t[e];if(!Ne(r)||r<0||r>=256)return!1}return!0}function ie(t,e){return!(typeof t!="string"||!t.match(/^0x[0-9A-Fa-f]*$/))}const te="0123456789abcdef";function Et(t,e){if(e||(e={}),typeof t=="number"){ee.checkSafeUint53(t,"invalid hexlify value");let r="";for(;t;)r=te[t&15]+r,t=Math.floor(t/16);return r.length?(r.length%2&&(r="0"+r),"0x"+r):"0x00"}if(typeof t=="bigint")return t=t.toString(16),t.length%2?"0x0"+t:"0x"+t;if(e.allowMissingPrefix&&typeof t=="string"&&t.substring(0,2)!=="0x"&&(t="0x"+t),gt(t))return t.toHexString();if(ie(t))return t.length%2&&(e.hexPad==="left"?t="0x0"+t.substring(2):e.hexPad==="right"?t+="0":ee.throwArgumentError("hex data is odd-length","value",t)),t.toLowerCase();if(Ce(t)){let r="0x";for(let n=0;n<t.length;n++){let o=t[n];r+=te[(o&240)>>4]+te[o&15]}return r}return ee.throwArgumentError("invalid hexlify value","value",t)}const mt="bignumber/5.7.0";var oe=lt.BN;const I=new c(mt),re={},xe=9007199254740991;let pe=!1;class E{constructor(e,r){e!==re&&I.throwError("cannot call constructor directly; use BigNumber.from",c.errors.UNSUPPORTED_OPERATION,{operation:"new (BigNumber)"}),this._hex=r,this._isBigNumber=!0,Object.freeze(this)}fromTwos(e){return x(i(this).fromTwos(e))}toTwos(e){return x(i(this).toTwos(e))}abs(){return this._hex[0]==="-"?E.from(this._hex.substring(1)):this}add(e){return x(i(this).add(i(e)))}sub(e){return x(i(this).sub(i(e)))}div(e){return E.from(e).isZero()&&b("division-by-zero","div"),x(i(this).div(i(e)))}mul(e){return x(i(this).mul(i(e)))}mod(e){const r=i(e);return r.isNeg()&&b("division-by-zero","mod"),x(i(this).umod(r))}pow(e){const r=i(e);return r.isNeg()&&b("negative-power","pow"),x(i(this).pow(r))}and(e){const r=i(e);return(this.isNegative()||r.isNeg())&&b("unbound-bitwise-result","and"),x(i(this).and(r))}or(e){const r=i(e);return(this.isNegative()||r.isNeg())&&b("unbound-bitwise-result","or"),x(i(this).or(r))}xor(e){const r=i(e);return(this.isNegative()||r.isNeg())&&b("unbound-bitwise-result","xor"),x(i(this).xor(r))}mask(e){return(this.isNegative()||e<0)&&b("negative-width","mask"),x(i(this).maskn(e))}shl(e){return(this.isNegative()||e<0)&&b("negative-width","shl"),x(i(this).shln(e))}shr(e){return(this.isNegative()||e<0)&&b("negative-width","shr"),x(i(this).shrn(e))}eq(e){return i(this).eq(i(e))}lt(e){return i(this).lt(i(e))}lte(e){return i(this).lte(i(e))}gt(e){return i(this).gt(i(e))}gte(e){return i(this).gte(i(e))}isNegative(){return this._hex[0]==="-"}isZero(){return i(this).isZero()}toNumber(){try{return i(this).toNumber()}catch{b("overflow","toNumber",this.toString())}return null}toBigInt(){try{return BigInt(this.toString())}catch{}return I.throwError("this platform does not support BigInt",c.errors.UNSUPPORTED_OPERATION,{value:this.toString()})}toString(){return arguments.length>0&&(arguments[0]===10?pe||(pe=!0,I.warn("BigNumber.toString does not accept any parameters; base-10 is assumed")):arguments[0]===16?I.throwError("BigNumber.toString does not accept any parameters; use bigNumber.toHexString()",c.errors.UNEXPECTED_ARGUMENT,{}):I.throwError("BigNumber.toString does not accept parameters",c.errors.UNEXPECTED_ARGUMENT,{})),i(this).toString(10)}toHexString(){return this._hex}toJSON(e){return{type:"BigNumber",hex:this.toHexString()}}static from(e){if(e instanceof E)return e;if(typeof e=="string")return e.match(/^-?0x[0-9a-f]+$/i)?new E(re,k(e)):e.match(/^-?[0-9]+$/)?new E(re,k(new oe(e))):I.throwArgumentError("invalid BigNumber string","value",e);if(typeof e=="number")return e%1&&b("underflow","BigNumber.from",e),(e>=xe||e<=-xe)&&b("overflow","BigNumber.from",e),E.from(String(e));const r=e;if(typeof r=="bigint")return E.from(r.toString());if(Ce(r))return E.from(Et(r));if(r)if(r.toHexString){const n=r.toHexString();if(typeof n=="string")return E.from(n)}else{let n=r._hex;if(n==null&&r.type==="BigNumber"&&(n=r.hex),typeof n=="string"&&(ie(n)||n[0]==="-"&&ie(n.substring(1))))return E.from(n)}return I.throwArgumentError("invalid BigNumber value","value",e)}static isBigNumber(e){return!!(e&&e._isBigNumber)}}function k(t){if(typeof t!="string")return k(t.toString(16));if(t[0]==="-")return t=t.substring(1),t[0]==="-"&&I.throwArgumentError("invalid hex","value",t),t=k(t),t==="0x00"?t:"-"+t;if(t.substring(0,2)!=="0x"&&(t="0x"+t),t==="0x")return"0x00";for(t.length%2&&(t="0x0"+t.substring(2));t.length>4&&t.substring(0,4)==="0x00";)t="0x"+t.substring(4);return t}function x(t){return E.from(k(t))}function i(t){const e=E.from(t).toHexString();return e[0]==="-"?new oe("-"+e.substring(3),16):new oe(e.substring(2),16)}function b(t,e,r){const n={fault:t,operation:e};return r!=null&&(n.value=r),I.throwError(t,c.errors.NUMERIC_FAULT,n)}const H=t=>!m.some(e=>e.id===t),Nt=t=>H(t)?W[m[0].id]:W[t],we=t=>H(t)?F[m[0].id]:F[t],Oe=({originChainId:t})=>H(t)?Se[m[0].id]:Se[t],m=[C,j,B],W={[C.id]:"6648936",[j.id]:"1869640809",[B.id]:"1634886255"},F={[C.id]:[P[C.id].alUSD,P[C.id].alETH,He],[j.id]:[P[j.id].alUSD,P[j.id].alETH,Re],[B.id]:[P[B.id].alUSD,P[B.id].alETH,be]},Se={[C.id]:"0x45BF3c737e57B059a5855280CA1ADb8e9606AC68",[j.id]:"0x8f7492DE823025b4CfaAB1D34c58963F2af5DEDA",[B.id]:"0xEE9deC2712cCE65174B561151701Bf54b99C24C8"},Ue="https://sdk-server.mainnet.connext.ninja",xt=({originDomain:t,destinationDomain:e})=>Te({queryKey:[Ie.ConnextSdk("relayerFee"),t,e],queryFn:async()=>{const r=await fetch(`${Ue}/estimateRelayerFee`,{method:"POST",body:JSON.stringify({originDomain:t,destinationDomain:e}),headers:{"Content-Type":"application/json"}});if(!r.ok)throw new Error(`Error calling estimateRelayerFee: ${r.status} ${r.statusText}`);const n=await r.json();return L(BigInt(E.from(n).toString()))},staleTime:1/0}),pt=({originDomain:t,destinationDomain:e,originTokenAddress:r,amount:n})=>Te({queryKey:[Ie.ConnextSdk("amountOut"),t,e,r,n],queryFn:async()=>{const o=await fetch(`${Ue}/calculateAmountReceived`,{method:"POST",body:JSON.stringify({originDomain:t,destinationDomain:e,originTokenAddress:r,amount:ne(n).toString()}),headers:{"Content-Type":"application/json"}});if(!o.ok)throw new Error(`Error calling estimateRelayerFee: ${o.status} ${o.statusText}`);const d=await o.json();return{amountReceived:L(BigInt(E.from(d.amountReceived).toString())),originSlippage:L(BigInt(E.from(d.originSlippage).toString())),routerFee:L(BigInt(E.from(d.routerFee).toString())),destinationSlippage:L(BigInt(E.from(d.destinationSlippage).toString())),isFastPath:d.isFastPath}},enabled:!ye(n)}),wt=()=>{const t=Xe(),e=Ae(),{address:r}=ze(),n=Ve({chainId:e.id}),{data:o}=ct({chainId:e.id});return qe({mutationFn:async({originDomain:d,destinationDomain:h,originChainId:g,originTokenAddress:l,amount:N,slippage:p,relayerFee:w})=>{if(!n)throw new Error("Public client not ready");if(!r)throw new Error("Not connected");if(!o)throw new Error("Wallet not ready");if(!w)throw new Error("Relayer fee not ready");const f={origin:d,destination:h,asset:l,amount:ne(N),relayerFee:ne(w),slippage:Ke(p,2)},u=d===W[C.id],M=h===W[C.id];u?(f.to=r,f.callData=fe("")):M?(l.toLowerCase()===Re.toLowerCase()||l.toLowerCase()===be.toLowerCase()?f.to="0xcfe063a764EA04A9A1Dc6cf8B8978955f779fc9F":f.to="0x45BF3c737e57B059a5855280CA1ADb8e9606AC68",f.callData=Je(ft("address"),[r])):(f.to=r,f.callData=fe(""));const O=Qe({abi:Ze(["function xcall(uint32 _destination, address _to, address _asset, address _delegate, uint256 _amount, uint256 _slippage, bytes calldata _callData) external payable returns (bytes32)"]),args:[parseInt(f.destination),f.to,f.asset,f.to,f.amount,f.slippage,f.callData]}),_=await n.prepareTransactionRequest({account:r,to:Oe({originChainId:g}),data:O,value:f.relayerFee,chainId:g});return await o.sendTransaction(_)},onSuccess:d=>{t({hash:d,description:"Bridge"});const h=()=>new Promise((g,l)=>{if(!n)return l(new Error("Public client not ready"));n.waitForTransactionReceipt({hash:d}).then(N=>N.status==="success"?g(N):l(new Error("Transaction reverted")))});de.promise(h,{loading:"Pending Bridge...",success:"Bridge confirmed",error:g=>g instanceof Ye||g instanceof et?"We could not confirm your bridge. Please check your wallet.":g instanceof Error?`Bridge failed: ${g.message}`:"Bridge failed"})},onError:d=>{de.error("Bridge failed",{description:d.message.includes("User rejected the request")?"Transaction rejected by user":d.message})}})},St=({transactionHash:t})=>t?s.jsxs("div",{className:"flex flex-col justify-center text-sm sm:items-end",children:[s.jsx("p",{children:"Transaction has been submitted, check Connext Explorer for status."}),!!t&&s.jsx("a",{href:`https://connextscan.io/tx/${t}`,target:"_blank",rel:"noreferrer",className:"underline hover:no-underline",children:"Connext Explorer"})]}):null,It=()=>{const t=Ae(),{switchChain:e}=tt(),[r,n]=y.useState(t.id),o=Nt(r),d=m.find(a=>a.id===r),[h,g]=y.useState(m.find(a=>a.id!==r).id),l=W[h],N=m.find(a=>a.id===h);y.useEffect(()=>{var S,U;if(H(t.id)){e({chainId:m[0].id}),n(m[0].id);const T=F[m[0].id][0];f(T);const R=(S=m.find(G=>G.id!==m[0].id))==null?void 0:S.id;R&&g(R)}else if(t.id!==r){n(t.id);const T=F[t.id][0];f(T);const R=(U=m.find(G=>G.id!==t.id))==null?void 0:U.id;R&&g(R)}},[t.id,r,e]);const{data:p}=rt(),[w,f]=y.useState(we(r)[0]),u=p==null?void 0:p.find(a=>a.address.toLowerCase()===w.toLowerCase()),M=p==null?void 0:p.filter(a=>we(r).includes(a.address)),[O,_]=y.useState(""),[X,ae]=y.useState("0.5"),{data:ce}=xt({originDomain:o,destinationDomain:l}),{data:D,isFetching:_e,isError:De}=pt({originDomain:o,destinationDomain:l,originTokenAddress:w,amount:O}),{isApprovalNeeded:le,approveConfig:v,approve:Pe}=nt({amount:O,tokenAddress:w,spender:Oe({originChainId:r}),decimals:u==null?void 0:u.decimals}),{mutate:Fe,data:je,isPending:Be}=wt(),Me=y.useCallback(a=>{var T;const S=Number(a);n(S);const U=F[S][0];if(f(U),_(""),S===h){const R=(T=m.find(G=>G.id!==S))==null?void 0:T.id;R&&g(R)}e({chainId:S})},[h,e]),Ge=y.useCallback(a=>{var U;const S=Number(a);if(g(S),_(""),S===r){const T=(U=m.find(R=>R.id!==S))==null?void 0:U.id;if(T){n(T),e({chainId:T});const R=F[T][0];f(R)}}},[r,e]),Le=()=>{if(le){v!=null&&v.request&&Pe(v.request);return}Fe({amount:O,destinationDomain:l,originDomain:o,originChainId:r,originTokenAddress:w,slippage:X,relayerFee:ce},{onSuccess:()=>_("")})};return s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[s.jsxs("div",{className:"flex flex-col gap-2",children:[s.jsx("p",{children:"Origin chain:"}),s.jsxs(z,{value:r.toString(),onValueChange:Me,children:[s.jsx(V,{className:"w-[180px]",children:s.jsx(q,{placeholder:"Origin chain",children:(d==null?void 0:d.name)??"Error"})}),s.jsx(K,{children:m.map(a=>s.jsx(J,{value:a.id.toString(),children:a.name},a.id))})]})]}),s.jsxs("div",{className:"flex flex-col gap-2",children:[s.jsx("p",{children:"Target chain:"}),s.jsxs(z,{value:h.toString(),onValueChange:Ge,children:[s.jsx(V,{className:"w-[180px]",children:s.jsx(q,{placeholder:"Target chain",children:(N==null?void 0:N.name)??"Error"})}),s.jsx(K,{children:m.map(a=>s.jsx(J,{value:a.id.toString(),children:a.name},a.id))})]})]}),s.jsxs("div",{className:"flex flex-col gap-2",children:[s.jsx("p",{children:"Router fee:"}),s.jsx(Q,{value:Z(D==null?void 0:D.routerFee),readOnly:!0,"aria-readonly":!0,type:"text",className:"text-right"})]}),s.jsxs("div",{className:"flex flex-col gap-2",children:[s.jsx("p",{children:"Relayer fee:"}),s.jsx(Q,{value:Z(ce,{decimals:5}),readOnly:!0,"aria-readonly":!0,type:"text",className:"text-right"})]}),s.jsxs("div",{className:"flex flex-col gap-2",children:[s.jsx("p",{children:"You receive:"}),s.jsx(Q,{value:De?"Error":_e?"Loading":Z(D==null?void 0:D.amountReceived,{decimals:4}),readOnly:!0,"aria-readonly":!0,type:"text",className:"text-right"})]})]}),s.jsxs("div",{className:"flex rounded border border-grey3inverse bg-grey3inverse dark:border-grey3 dark:bg-grey3",children:[s.jsxs(z,{value:w,onValueChange:a=>f(a),children:[s.jsx(V,{className:"h-auto w-24 sm:w-56",children:s.jsx(q,{placeholder:"Token",asChild:!0,children:s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("img",{src:`./assets/token-icons/${u==null?void 0:u.symbol}.svg`,alt:u==null?void 0:u.symbol,className:"h-12 w-12"}),s.jsx("span",{className:"hidden text-xl sm:inline",children:u==null?void 0:u.symbol})]})})}),s.jsx(K,{children:M==null?void 0:M.map(a=>s.jsx(J,{value:a.address,children:a.symbol},a.address))})]}),s.jsx(st,{amount:O,setAmount:_,tokenAddress:(u==null?void 0:u.address)??it,tokenSymbol:(u==null?void 0:u.symbol)??"",tokenDecimals:18})]}),s.jsxs("div",{className:"flex w-full flex-col sm:flex-row sm:items-center sm:justify-between",children:[s.jsx(ot,{slippage:X,setSlippage:ae}),s.jsx(St,{transactionHash:je})]}),s.jsx(at,{variant:"outline",width:"full",disabled:ye(O)||Be,onClick:Le,children:le?"Approve":"Bridge"})]})};export{It as ConnextBridgeWidget};
